!function(e){"use strict";function n(e,n){return e(n={exports:{}},n.exports),n.exports}var t=1e3,r=60*t,o=60*r,s=24*o,a=365.25*s,i=function(e,n){n=n||{};var i,u=typeof e;if("string"===u&&e.length>0)return function(e){if((e=String(e)).length>100)return;var n=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!n)return;var i=parseFloat(n[1]);switch((n[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return i*a;case"days":case"day":case"d":return i*s;case"hours":case"hour":case"hrs":case"hr":case"h":return i*o;case"minutes":case"minute":case"mins":case"min":case"m":return i*r;case"seconds":case"second":case"secs":case"sec":case"s":return i*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}(e);if("number"===u&&!1===isNaN(e))return n.long?c(i=e,s,"day")||c(i,o,"hour")||c(i,r,"minute")||c(i,t,"second")||i+" ms":function(e){if(e>=s)return Math.round(e/s)+"d";if(e>=o)return Math.round(e/o)+"h";if(e>=r)return Math.round(e/r)+"m";if(e>=t)return Math.round(e/t)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function c(e,n,t){if(!(e<n))return e<1.5*n?Math.floor(e/n)+" "+t:Math.ceil(e/n)+" "+t+"s"}var u=n(function(e,n){function t(e){var t;function o(){if(o.enabled){var e=o,r=+new Date,s=r-(t||r);e.diff=s,e.prev=t,e.curr=r,t=r;for(var a=new Array(arguments.length),i=0;i<a.length;i++)a[i]=arguments[i];a[0]=n.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");var c=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(t,r){if("%%"===t)return t;c++;var o=n.formatters[r];if("function"==typeof o){var s=a[c];t=o.call(e,s),a.splice(c,1),c--}return t}),n.formatArgs.call(e,a),(o.log||n.log||console.log.bind(console)).apply(e,a)}}return o.namespace=e,o.enabled=n.enabled(e),o.useColors=n.useColors(),o.color=function(e){var t,r=0;for(t in e)r=(r<<5)-r+e.charCodeAt(t),r|=0;return n.colors[Math.abs(r)%n.colors.length]}(e),o.destroy=r,"function"==typeof n.init&&n.init(o),n.instances.push(o),o}function r(){var e=n.instances.indexOf(this);return-1!==e&&(n.instances.splice(e,1),!0)}(n=e.exports=t.debug=t.default=t).coerce=function(e){return e instanceof Error?e.stack||e.message:e},n.disable=function(){n.enable("")},n.enable=function(e){var t;n.save(e),n.names=[],n.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(t=0;t<o;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")));for(t=0;t<n.instances.length;t++){var s=n.instances[t];s.enabled=n.enabled(s.namespace)}},n.enabled=function(e){if("*"===e[e.length-1])return!0;var t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=i,n.instances=[],n.names=[],n.skips=[],n.formatters={}}),d=(u.coerce,u.disable,u.enable,u.enabled,u.humanize,u.instances,u.names,u.skips,u.formatters,n(function(e,n){function t(){var e;try{e=n.storage.debug}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e}(n=e.exports=u).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},n.formatArgs=function(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+n.humanize(this.diff),!t)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var o=0,s=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(o++,"%c"===e&&(s=o))}),e.splice(s,0,r)},n.save=function(e){try{null==e?n.storage.removeItem("debug"):n.storage.debug=e}catch(e){}},n.load=t,n.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},n.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),n.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],n.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},n.enable(t())}));d.log,d.formatArgs,d.save,d.load,d.useColors,d.storage,d.colors;function l(e){return Math.random()<e?1:0}function C(e){return function(e){for(let n=0;n<e.length;n++)if(l(e[n]/e.slice(n).reduce((e,n)=>e+n,0)))return n;return e.length-1}(e)}function f(e){return new Promise(n=>{setTimeout(n,e)})}d.enable("*");let m,g,h,p,F=38,y=!1,v="Immortal longings in me: now no more";function w(e){d("onSpeedChange")("speed changed to",F=e.target.value)}async function b(n,t){const r=e.tidy(()=>(function(n,t){const r=t.input.shape[0],o=n.length,s=t.input.shape[2],a=e.tidy(()=>(function(n,t,r){const o=function(e){const n=Array.from({length:e.length});for(let r=0;r<e.length;r++)n[r]=9===(t=e.charCodeAt(r))?1:10===t?97:32<=t&&t<=126?t-30:0;var t;return n}(n),s=e.oneHot(o,r);return e.stack(Array.from({length:t}).map(()=>s))})(n,r,s)),i=t.predict(a,{batchSize:r});return e.slice3d(i,[0,o-1,0],[r,1,s]).reshape([r,s]).sum(0)})(n,t)),o=await r.data();r.dispose();const s=C(o);return 1===(a=s)?String.fromCharCode(9):97===a?String.fromCharCode(10):32<=a+30&&a+30<=126?String.fromCharCode(a+30):String.fromCharCode(0);var a}window.addEventListener("DOMContentLoaded",async function(){const n=d("main");let t;m=document.querySelector("#predictionContainer"),g=document.querySelector("#speedControlSlider"),h=document.querySelector("pre"),p=document.querySelector("#controls button"),g.value=F,g.addEventListener("change",w),p.addEventListener("click",()=>(function(e){y?(y=!1,p.innerText="Start"):(y=!0,p.classList.add("hidden"),m.classList.remove("editable"),h.removeAttribute("contenteditable"),async function(e){for(;y;){const[n]=await Promise.all([b(v,e),f(6*(41-F))]);h.innerText+=n,v=v.substr(1)+n}}(e))})(t)),h.innerText=v;try{t=await e.loadModel("indexeddb://model_shakespeare"),n("loaded from idb")}catch(r){t=await e.loadModel("model/shakespeare/v1/model.json");const o=await t.save("indexeddb://model_shakespeare");n("saving to idb:",o)}t.summary(),document.querySelector("#loadingMessage").classList.add("hidden"),document.querySelector("#controls").classList.remove("hidden"),m.classList.remove("hidden"),setTimeout(()=>h.focus(),0)})}(tf);
